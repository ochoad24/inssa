(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{Gfm6:function(t,e,o){"use strict";o.r(e);var i=o("o0o1"),n=o.n(i),r=o("Snq/"),s=o.n(r),a=o("vDqi"),l=o.n(a),c=o("LvDl"),u=o.n(c),d=o("e7F3"),p=o("XuX8"),v=o.n(p),m=o("v8TL");function h(t,e,o,i,n,r,s){try{var a=t[r](s),l=a.value}catch(t){return void o(t)}a.done?e(l):Promise.resolve(l).then(i,n)}function f(t){return function(){var e=this,o=arguments;return new Promise((function(i,n){var r=t.apply(e,o);function s(t){h(r,i,n,s,a,"next",t)}function a(t){h(r,i,n,s,a,"throw",t)}s(void 0)}))}}function g(t){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}v.a.directive("VeeValidate",d.b),v.a.use(d.b,{inject:!0});d.a.localize("es",{custom:{name:{required:"El nombre del rol es requerido"}}});var b={components:{"v-select":s.a},data:function(){return{rol:null,rols:[],popupRol:{title:"Nuevo rol",active:!1},name:"",idRol:0,permits:[],permit:null,myPermits:[]}},methods:{showItem:function(t){return m.a.showItem(t)},getIndex:function(t,e){return t.findIndex((function(t){return t.id==e}))},onSearch:function(t,e){e(!0),this.search(e,t,this)},search:u.a.debounce((function(t,e,o){l.a.get("/api/searchRol?filter=".concat(e)).then((function(e){o.rols=e.data.data,t(!1)})).catch((function(t){console.log(t)}))}),350),newRol:function(){this.name="",this.popupRol.title="Nuevo rol",this.popupRol.active=!0},editRol:function(){null!==this.rol&&""!==this.rol&&this.rol!=={}&&void 0!==g(this.rol)?1!==this.rol.id?(this.name=this.rol.name,this.idRol=this.rol.id,this.popupRol.title="Editar rol",this.popupRol.active=!0):this.showAlert("Error","El administrador no puede editarse"):this.showAlert("Error","Seleccione un rol")},submitForm:function(){"Nuevo rol"===this.popupRol.title?this.saveRol():this.updateRol()},saveRol:function(){var t=this;this.$validator.validateAll().then((function(e){e&&(t.$vs.loading(),l.a.post("/api/rol",{name:t.name}).then((function(e){t.$vs.loading.close(),t.$vs.notify({title:"Listo",color:"success",position:"top-right",text:"".concat(e.data.message)}),t.popupRol.active=!1,t.rol={id:e.data.idRol,name:t.name},t.roles=[],t.changeRol()})).catch((function(e){t.$vs.loading.close(),t.$vs.notify({title:"Error",color:"danger",position:"top-right",text:"".concat(e.response.data.message)})})))}))},updateRol:function(){var t=this;this.$validator.validateAll().then((function(e){e&&(t.$vs.loading(),l.a.put("/api/rol/".concat(t.rol.id),{name:t.name}).then((function(e){t.$vs.loading.close(),t.$vs.notify({title:"Listo",color:"success",position:"top-right",text:"".concat(e.data.message)}),t.popupRol.active=!1,t.rol={id:e.data.idRol,name:t.name},t.rols=[],t.changeRol()})).catch((function(e){t.$vs.loading.close(),t.$vs.notify({title:"Error",color:"danger",position:"top-right",text:"".concat(e.response.data.message)})})))}))},showAlert:function(t,e){this.$vs.dialog({color:"primary",title:t,text:e,acceptText:"Aceptar"})},dialogDeleteUser:function(){if(null!==this.rol&&""!==this.rol&&this.rol!=={}&&void 0!==g(this.rol))if(1!==this.rol.id){this.$vs.dialog({acceptText:"Si",cancelText:"No",type:"confirm",color:"danger",title:"Eliminar",text:"¿Desea eliminar este rol?.",accept:this.deleteRol})}else this.showAlert("Error","El administrador no puede eliminarse");else this.showAlert("Error","Seleccione un rol")},deleteRol:function(){var t=this;t.$vs.loading(),l.a.delete("/api/rol/".concat(t.rol.id)).then((function(e){t.$vs.loading.close(),t.$vs.notify({title:"Listo",color:"success",position:"top-right",text:"".concat(e.data.message)}),t.rol=null,t.rols=[]})).catch((function(e){t.$vs.loading.close(),t.$vs.notify({title:"Error",color:"danger",position:"top-right",text:"".concat(e.response.data.message)})}))},getPermits:function(){var t=this;return f(n.a.mark((function e(){var o;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=t).$vs.loading(),e.next=4,l.a.get("/api/getPermits").then((function(t){o.$vs.loading.close(),o.permits=t.data})).catch((function(t){o.$vs.loading.close(),console.log(t)}));case 4:case"end":return e.stop()}}),e)})))()},changeRol:function(){var t=this;return f(n.a.mark((function e(){var o;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t.rol&&""!==t.rol&&t.rol!=={}&&void 0!==g(t.rol)){e.next=2;break}return e.abrupt("return");case 2:if(null!==t.permit&&""!==t.permit&&t.permit!=={}&&void 0!==g(t.permit)){e.next=4;break}return e.abrupt("return");case 4:return(o=t).$vs.loading(),e.next=8,l.a.get("/api/getPermit/".concat(o.rol.id,"/").concat(o.permit.id)).then((function(t){o.$vs.loading.close(),o.myPermits=t.data})).catch((function(t){o.$vs.loading.close(),console.log(t)}));case 8:case"end":return e.stop()}}),e)})))()},onUpdatePermit:function(t){this.updatePermit(t,this)},updatePermit:u.a.debounce((function(t,e){if(1===e.rol.id)return e.showAlert("Error","Los permisos del administrador no pueden editarse"),void e.changeRol();e.$vs.loading(),l.a.put("/api/updatePermit/".concat(t),{status:e.myPermits[e.getIndex(e.myPermits,t)].status}).then((function(t){e.$vs.loading.close(),e.$vs.notify({title:"Listo",color:"success",position:"top-right",text:"".concat(t.data.message)}),e.changeRol()})).catch((function(t){e.$vs.loading.close(),e.$vs.notify({title:"Error",color:"danger",position:"top-right",text:"".concat(t.response.data.message)})}))}),350)},mounted:function(){this.getPermits()}},x=o("KHd+"),w=Object(x.a)(b,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[t.showItem("Ver lista de roles")?o("vx-card",{attrs:{title:"Roles"}},[o("div",{staticClass:"vx-row"},[o("div",{staticClass:"vx-col w-full mt-5"},[o("label",{staticClass:"vs-input--label"},[t._v("Rol")]),t._v(" "),o("v-select",{attrs:{options:t.rols,filterable:!1,label:"name"},on:{search:t.onSearch,input:t.changeRol},model:{value:t.rol,callback:function(e){t.rol=e},expression:"rol"}}),t._v(" "),o("br"),t._v(" "),o("div",{staticClass:"btn-group"},[t.showItem("Crear rol")?o("vs-button",{on:{click:function(e){return t.newRol()}}},[t._v("Nuevo rol")]):t._e(),t._v(" "),t.showItem("Editar rol")?o("vs-button",{on:{click:function(e){return t.editRol()}}},[t._v("Editar rol")]):t._e(),t._v(" "),t.showItem("Eliminar rol")?o("vs-button",{on:{click:function(e){return t.dialogDeleteUser()}}},[t._v("Eliminar rol")]):t._e()],1)],1)])]):t._e(),t._v(" "),o("br"),t._v(" "),t.showItem("Ver permisos")?o("vx-card",{attrs:{title:"Permisos"}},[o("div",{staticClass:"vx-row"},[o("div",{staticClass:"vx-col w-full mt-5"},[o("label",{staticClass:"vs-input--label"},[t._v("Módulos")]),t._v(" "),o("v-select",{attrs:{options:t.permits,filterable:!0,label:"name"},on:{input:t.changeRol},model:{value:t.permit,callback:function(e){t.permit=e},expression:"permit"}})],1)]),t._v(" "),o("div",{staticClass:"vx-row"},[o("ul",{staticClass:"vx-col w-full mt-5"},t._l(t.myPermits,(function(e){return o("li",{key:e.id},[o("label",[t._v(t._s(e.name))]),t._v(" "),o("vs-switch",{attrs:{disabled:!t.showItem("Activar o desactivar Permiso")},on:{change:function(o){return t.onUpdatePermit(e.id)}},model:{value:t.myPermits[t.getIndex(t.myPermits,e.id)].status,callback:function(o){t.$set(t.myPermits[t.getIndex(t.myPermits,e.id)],"status",o)},expression:"\n                            myPermits[getIndex(myPermits, item.id)].status\n                        "}})],1)})),0)])]):t._e(),t._v(" "),o("vs-popup",{attrs:{title:t.popupRol.title,active:t.popupRol.active},on:{"update:active":function(e){return t.$set(t.popupRol,"active",e)}}},[o("form",[o("div",{staticClass:"con-exemple-prompt"},[o("div",{staticClass:"vx-row"},[o("div",{staticClass:"vx-col w-full mt-5"},[o("vs-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"w-full",attrs:{label:"Nombre",name:"name"},on:{input:t.changeRol},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),t._v(" "),o("span",{staticClass:"text-danger"},[t._v(t._s(t.errors.first("name")))])],1)]),t._v(" "),o("vs-button",{staticClass:"mt-5 block",attrs:{type:"filled"},on:{click:function(e){return t.submitForm()}}},[t._v("Guardar")])],1)])])],1)}),[],!1,null,null,null);e.default=w.exports},v8TL:function(t,e,o){"use strict";o.d(e,"a",(function(){return i}));var i={showItem:function(t){return void 0!==localStorage.getItem("permitKey")&&void 0!==JSON.parse(localStorage.getItem("permitKey")).find((function(e){return e.name===t&&1===e.status}))}}}}]);